language: node_js
matrix:
  include:
  - os: linux
    group: stable
    dist: trusty
    addons:
      apt:
        sources:
        - google-chrome
        packages:
        - google-chrome-stable
    node_js: '8'
    sudo: required
  - os: osx
    osx_image: xcode9.0
    node_js: '8'
    sudo: required
    env:
    - HOMEBREW_CASK_OPTS='--appdir=/Applications'
    - ELECTRON_CACHE=$HOME/.cache/electron
    - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder
cache:
  yarn: true
  directories:
  - node_modules
  - "$HOME/.cache/electron"
  - "$HOME/.cache/electron-builder"
before_install:
- |
  if [ "$TRAVIS_OS_NAME" = "osx" ]; then
    brew update > /dev/null
    brew cask install google-chrome
    mkdir -p /tmp/git-lfs && curl -L https://github.com/github/git-lfs/releases/download/v2.3.1/git-lfs-$([ "$TRAVIS_OS_NAME" == "linux" ] && echo "linux" || echo "darwin")-amd64-2.3.1.tar.gz | tar -xz -C /tmp/git-lfs --strip-components 1
    export PATH="/tmp/git-lfs:$PATH"
  else
    sudo apt-get install --no-install-recommends -y  software-properties-common icnsutils graphicsmagick build-essential g++ g++-multilib gcc gcc-multilib default-jre
    sudo apt-get update
    # clean
    sudo apt-get clean && sudo rm -rf /var/lib/apt/lists/*
  fi
install:
- yarn
before_script:
- export GITHUB_TOKEN=$GITHUB_TOKEN
- |
  if [ "$TRAVIS_OS_NAME" = "linux" ]; then
    export DISPLAY=:99.0
    sh -e /etc/init.d/xvfb start
  fi
- git lfs pull
script:
- yarn test
- |
  if [ "$TRAVIS_OS_NAME" = "linux" ]; then
    yarn release -l
  else
    yarn release -m
  fi
branches:
  except:
  - "/^v\\d+\\.\\d+\\.\\d+$/"
env:
  global:
    secure: akWURxNXSWCEEDGM2JjFPushnL05bqmIgVyiMCHeCZQMk2QVePR7x8tL9vFQASBaAn0klUNkYiYYvE5kdnxzvxP3l/PYLvR+khGZL8hpn5pF7G2hRX53Medh1O0y7bLIksknaFKiwTlrhHfN0tpCY8jyLDvkUbuaMqD/UklhLkjdj5Xb6GPjYOh8rCvk2x4F1Vj5IiqGBV/jfUHeOOSv8Qrj8GVbXjdTHU/2uGi0eagbiA5aWoH8psQrC24MKZI65c4TB2XvOYWH1VIhVv3H6pEzCGOomHtNKhHAh1ItTLJpueouyHna3tTIX7o7/CBxmKUAVZafgDEY/IH6HASNIpsORnJxi51VVwcUALacrM+Wl2ED9l6gv7wBJnbhaTVbNNTDUL6wB+ed8WhcvcikQGetGC6/WMc6XUT191UZxPZazjtm5VT0JZ2wPbVJlzXzHTP4sHq9hEXBczVWRY8dtPO03nN8pJ4MUVBUMtCfiHb9+XMbTbBCVbrn4UwaT83tkYkldpG6aCXWQLNJphf+D1rODjd8BLkK/UraxOvfkG8RNJzTsFZVLKghTYje6UmBxDDr4A1/YZpwOy8MZFwY6rudqiCzwB/0rqa/9lEcweEj/CcAX+gEUaHLK6md8d6b/LG/Pkg2Hi6DgIM1toM0+wXhNsiLnyTpvVp5CSYKPk8=
